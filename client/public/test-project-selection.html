<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Selection Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #0f172a;
            color: white;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #374151;
            border-radius: 8px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #065f46; }
        .error { background: #7f1d1d; }
        .info { background: #1e3a8a; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        .project-item {
            background: #1f2937;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid #374151;
        }
        .project-item:hover {
            background: #374151;
            border-color: #3b82f6;
        }
        .log {
            background: #111827;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Project Selection Test</h1>
    
    <div class="test-section">
        <h2>1. Test API Connection</h2>
        <button onclick="testAPI()">Test Projects API</button>
        <div id="api-status" class="status info">Click to test API connection</div>
    </div>

    <div class="test-section">
        <h2>2. Load Projects</h2>
        <button onclick="loadProjects()">Load Projects</button>
        <div id="projects-container"></div>
    </div>

    <div class="test-section">
        <h2>3. Test Project Selection</h2>
        <div id="selection-log" class="log">Click on a project above to test selection...</div>
    </div>

    <div class="test-section">
        <h2>4. Console Logs</h2>
        <div id="console-log" class="log">Console logs will appear here...</div>
    </div>

    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        function addToLog(type, message) {
            const logDiv = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${type}: ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog('LOG', args.join(' '));
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToLog('WARN', args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog('ERROR', args.join(' '));
        };

        async function testAPI() {
            const statusDiv = document.getElementById('api-status');
            try {
                const response = await fetch('/api/projects');
                const data = await response.json();
                
                if (data.success) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = `✅ API working! Found ${data.data.length} projects`;
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '❌ API returned error';
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `❌ API error: ${error.message}`;
            }
        }

        async function loadProjects() {
            const container = document.getElementById('projects-container');
            try {
                const response = await fetch('/api/projects');
                const data = await response.json();
                
                if (data.success) {
                    container.innerHTML = '<h3>Available Projects:</h3>';
                    data.data.forEach(project => {
                        const projectDiv = document.createElement('div');
                        projectDiv.className = 'project-item';
                        projectDiv.innerHTML = `
                            <h4>${project.name}</h4>
                            <p><strong>ID:</strong> ${project.id}</p>
                            <p><strong>Path:</strong> ${project.path}</p>
                            <p><strong>Description:</strong> ${project.description}</p>
                            <p><strong>Status:</strong> ${project.scan_status}</p>
                        `;
                        projectDiv.onclick = () => testProjectSelection(project);
                        container.appendChild(projectDiv);
                    });
                } else {
                    container.innerHTML = '<p class="error">Failed to load projects</p>';
                }
            } catch (error) {
                container.innerHTML = `<p class="error">Error loading projects: ${error.message}</p>`;
            }
        }

        function testProjectSelection(project) {
            const logDiv = document.getElementById('selection-log');
            const timestamp = new Date().toLocaleTimeString();
            
            logDiv.innerHTML += `[${timestamp}] Project clicked: ${project.name} (ID: ${project.id})\n`;
            logDiv.innerHTML += `[${timestamp}] Path: ${project.path}\n`;
            logDiv.innerHTML += `[${timestamp}] Status: ${project.scan_status}\n`;
            logDiv.innerHTML += `[${timestamp}] ---\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            
            // Simulate what the React app would do
            console.log('Project selected:', project);
            console.log('Setting current project and scan path...');
            
            // Test if we can access the project path
            if (project.path) {
                console.log('Project path is available:', project.path);
            } else {
                console.warn('Project path is not available');
            }
        }

        // Auto-test API on page load
        window.onload = function() {
            testAPI();
        };
    </script>
</body>
</html>
